<main class="article-wrapper">
    {% if is_search %}
    <div class="search-result flex-r">
        <div>搜索關鍵詞 <span>{{ keyword }}</span></div>
        <div>共 <span>{{ search_count }}</span> 筆</div>
    </div>
    {% endif %}
    <div class="article-list" id="articleList" data-isLogin="{{ session.get('is_login') }}">
        {% if result %}
        {% for article, nickname in result %}
        <div class="article-row flex-r">
            <div class="row-avatar">
                <img src="{{ article.article_image }}" alt="">
            </div>
            <div class="row-desc flex-c">
                <div class="article-title flex-r">
                    <a href="/detail?aid={{ article.aid }}">
                        {{ article.title }}
                    </a>
                    <span class="collection" id="collection{{ article.aid }}" data-collected="{{ article.collected }}" data-aid="{{ article.aid }}">{{ '取消收藏' if article.collected else '收藏' }}</span>
                </div>
                <div class="article-info flex-r">
                    <div class="info-left">
                                <span class="label">
                                    {{ article.label }}
                                </span>
                        <span class="views">
                                            <i class="iconfont icon-yanjing"></i>
                                            <span>
                                                {{ article.browse_num }}
                                            </span>
                                        </span>
                        <span>
                                    {{ nickname }}
                                </span>
                        <span>
                                    {{ article.article_tag }}
                                </span>
                    </div>
                    <div class="info-right">
                                <span>
                                    {{ article.create_time }}
                                </span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>什麼都沒有，寫個文章吧</p>
        {% endif %}
    </div>
    <script>
        // 登入後
        const $collection = document.getElementById('collection59');
        // collection
        let collected = $collection.getAttribute('data-collected');
        const $articleList = document.getElementById('articleList');
        const isLogin = $articleList.getAttribute('data-isLogin');
        // const coll = document.getElementById('coll' + //);
        // let collected = 0;
        // click
        $articleList.onclick = (e) => {
            // let collected = e.target.getAttribute('data-collected');
            // console.log(collected);
            // let collected = e.target.getAttribute('data-collected');
            const aid = e.target.getAttribute('data-aid');
            const $currCollection = e.target;

            if (collected) {
                console.log('aid:', aid, 'collected:', collected);
            }

            if (aid) {
                if (collected) {
                    collected = 0;
                    axios.post('/collect/update', {
                        aid: aid,
                        collected: collected
                    }).then(res => {
                        if (res.data.status === 3000) {
                            $currCollection.innerHTML = '收藏';
                        }
                    });
                } else {
                    collected = 1;
                    axios.post('/collect/update', {
                        aid: aid,
                        collected: collected
                    }).then(res => {
                        if (res.data.status === 3000) {
                            $currCollection.innerHTML = '取消收藏';
                        }
                    });
                }
            }
        };
    </script>
</main>