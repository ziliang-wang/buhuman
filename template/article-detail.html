<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta property="og:title" content="不良人互動社群"/>
    <meta property="og:image" content="images/logo.png"/>
    <meta property="og:description" content="挺有意思的社群-不良人互動社群"/>
    <meta property="og:url" content="https://www.baidu.com"/>
    <title>不良人互動社群</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/detail.css">
    <script src="js/header.js"></script>
    <script src="js/axios.min.js"></script>
</head>
<body>
{% include 'common/header.html' %}
<section class="detail-container">
    <div class="detail-wrap center-wrap">
        <div class="detail-path">
                <span class="detail-path-title">
                    首頁&nbsp;&nbsp;>&nbsp;&nbsp;{{ article.label_name }}&nbsp;&nbsp;>&nbsp;&nbsp;{{ article.title }}
                </span>
            <span class="share">
                <i class="iconfont icon-facebook facebook" title="分享到Facebook"></i>
                <i class="iconfont icon-line line" title="分享到Line"></i>
                <i class="iconfont icon-twitterB twitter" title="分享到Twitter"></i>
                <i class="iconfont icon-weibo weibo" title="分享到微博"></i>
            </span>
        </div>
        <div class="detail-main">
            <div class="detail-main-left">
                <div class="detail-left-title">
                        <span>
                            {{ article.title }}
                        </span>
                </div>
                <div class="detail-left-info flex-r">
                    <div class="detail-info-tag">
                        <span class="tag-name">標籤:</span>
                        {% for tag_name in tags_list %}
                        <span class="tag-value">
                                {{ tag_name }}
                            </span>
                        {% endfor %}
                    </div>
                    <div class="detail-info-collection" data-isLogin="{{ session.get('is_login') }}"
                         data-aid="{{ article.aid }}" id="doCollect">收藏
                    </div>
                    <script>
                        const $doCollect = document.getElementById('doCollect');
                        let collected = 0;
                        let isLogin = $doCollect.getAttribute('data-isLogin');
                        let aid = $doCollect.getAttribute('data-aid');
                        // console.log('isLogin', isLogin);
                        // mounted
                        if (isLogin === 'true') {
                            axios.get('/collect/status', {
                                params: {
                                    aid: aid
                                }
                            }).then(res => {
                                if (res.data.status === 3000) {
                                    collected = res.data.collected;
                                    if (collected) {
                                        $doCollect.innerHTML = '已收藏';
                                    } else {
                                        $doCollect.innerHTML = '收藏';
                                    }
                                }
                            });
                        }
                        // click
                        $doCollect.onclick = function () {
                            if (collected) {
                                collected = 0;
                                axios.post('/collect/update', {
                                    aid: aid,
                                    collected: collected
                                }).then(res => {
                                    if (res.data.status === 3000) {
                                        this.innerHTML = '收藏';
                                    }
                                });
                            } else {
                                collected = 1;
                                axios.post('/collect/update', {
                                    aid: aid,
                                    collected: collected
                                }).then(res => {
                                    if (res.data.status === 3000) {
                                        this.innerHTML = '已收藏';
                                    }
                                });
                            }
                        };
                    </script>
                </div>
                <div class="detail-content-wrapper">
                    {{ article.article_content | safe }}
                </div>
                <div class="detail-publish">
                    發表于 {{ article.create_time }} 共 {{ article.browse_num }} 人浏览
                </div>
                <div class="detail-inform">
                    本文發布于"不良人" ，分享請註明出處，謝謝合作
                </div>
                <div class="praise-container">
                    <div class="praise-wrapper" id="praise" data-isLogin="{{ session.get('is_login') }}"
                         data-aid="{{ article.aid }}">
                        <i class="iconfont icon-dianzan" id="praiseIcon"></i>
                    </div>
                </div>
                <div class="forta" id="forta">
                    為 TA 點讚
                </div>
                <!-- 點讚 script -->
                <script>

                </script>
            </div>
            <!--  detail right  -->
            <div class="detail-main-right">
                <div class="detail-right-top">
                    <div class="author-info flex-r">
                        <div class="author-avatar">
                            <img src="{{ user.avatar }}" alt="">
                        </div>
                        <div class="author-desc">
                            <div class="author-name">{{ user.nickname }}</div>
                            <div class="author-title">{{ user.job }}</div>
                        </div>
                    </div>
                    <div class="author-achievement flex-r">
                        <div class="aleft">文章</div>
                        <div class="fans">粉絲</div>
                        <div class="aright">獲讚與收藏</div>
                    </div>
                    <div class="author-achievement-grade flex-r">
                        <div class="grade-left">{{ user_articles }}篇</div>
                        <div class="grade-middle">{{ 0 if not fans_num else fans_num }}</div>
                        <div class="grade-right">{{ collection_and_praise }}</div>
                    </div>
                    <div class="concern" id="concern" data-isLogin="{{ session.get('is_login') }}"
                         data-tid="{{ article.uid }}">
                        <span id="concernAuthor">關注作者，訂閱最新文章</span>
                    </div>
                    <!-- 關注 script -->
                    <script>
                        const $concern = document.getElementById('concern');
                        // const $praiseIcon = document.getElementById('praiseIcon');
                        // const $forta = document.getElementById('forta');
                        let concerned = 0;
                        isLogin = $concern.getAttribute('data-isLogin');
                        tid = $concern.getAttribute('data-tid');
                        // console.log('isLogin', isLogin);
                        // mounted
                        axios.get('/concern/status', {
                            params: {
                                tid: tid
                            }
                        }).then(res => {
                            if (res.data.status === 5000) {
                                concerned = res.data.concerned;
                                if (concerned) {
                                    // $praise.classList.add('praise-alter');
                                    // $praiseIcon.classList.add('i-alter');
                                    $concern.innerHTML = '已關注';
                                } else {
                                    // $praise.classList.remove('praise-alter');
                                    // $praiseIcon.classList.remove('i-alter');
                                    $concern.innerHTML = '關注作者，訂閱最新文章';
                                }
                                // if (!res.data.praisedNum) {
                                //     $forta.innerHTML = `為 TA 點讚`;
                                // } else {
                                //     $forta.innerHTML = `${res.data.concernedNum}人點讚`;
                                // }
                            }
                        });
                        // click
                        $concern.onclick = function () {
                            if (concerned) {
                                concerned = 0;
                                axios.post('/concern/update', {
                                    tid: tid,
                                    concerned: concerned
                                }).then(res => {
                                    if (res.data.status === 5000) {
                                        // $praise.classList.remove('praise-alter');
                                        // $praiseIcon.classList.remove('i-alter');
                                        $concern.innerHTML = '關注作者，訂閱最新文章';
                                        // if (!res.data.concernedNum) {
                                        //     $forta.innerHTML = `為 TA 點讚`;
                                        // } else {
                                        //     $forta.innerHTML = `${res.data.concernedNum}人點讚`;
                                        // }
                                    }
                                });
                            } else {
                                concerned = 1;
                                axios.post('/concern/update', {
                                    tid: tid,
                                    concerned: concerned
                                }).then(res => {
                                    if (res.data.status === 5000) {
                                        // $praise.classList.add('praise-alter');
                                        // $praiseIcon.classList.add('i-alter');
                                        $concern.innerHTML = '已關注';
                                        // if (!res.data.concernedNum) {
                                        //     $forta.innerHTML = `為 TA 點讚`;
                                        // } else {
                                        //     $forta.innerHTML = `${res.data.concernedNum}人點讚`;
                                        // }
                                    }
                                });
                            }
                        };

                        // const $concernAuthor = document.getElementById('concernAuthor');
                        //
                        // $concernAuthor.onmouseover = function () {
                        //     if (this.innerHTML === '已關注') {
                        //         this.innerHTML = '取消關注';
                        //     }
                        // };
                        //
                        // $concernAuthor.onmouseleave = function () {
                        //
                        // };
                    </script>
                </div>
                <div class="detail-right-bottom">
                    <div class="recommend-title">
                        相關文章推薦
                    </div>
                    <ul class="recommend-list">
                        {% if not relation_list %}
                        <li class="recommend-item flex-r">
                            <!--                                <span class="iconfont icon-caogao05"></span>-->
                            <span class="recommend-item-content">
                                    暫無相關文章
                                </span>
                        </li>
                        {% else %}
                        {% for item in relation_list %}
                        <li class="recommend-item flex-r">
                            <span class="iconfont icon-caogao05"></span>
                            <span class="recommend-item-content">
                                                <a href="/detail?aid={{ item.aid }}">
                                                    {{ item.title }}
                                                </a>
                                            </span>
                        </li>
                        {% endfor %}
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="detail-comment-num">2 評論</div>
        <div class="detail-comment">
            <div class="write-comment flex-r">
                <div class="write-left">評論</div>
                <div class="write-right">寫下您的評論</div>
            </div>
            <div class="comment-item flex-r">
                <div class="comment-item-left">
                    <div class="comment-item-left-avatar">
                        <img src="images/headers/3.jpg" alt="">
                    </div>
                    <div class="comment-item-left-floor">
                        2樓
                    </div>
                </div>
                <div class="comment-item-right">
                    <div class="comment-item-right-author">
                        大周
                    </div>
                    <div class="comment-item-right-content">
                        <span>smile</span>
                    </div>
                    <div class="comment-item-right-info flex-r">
                        <div class="comment-item-right-action flex-r">
                            <div class="action-praise">
                                <i class="iconfont icon-dianzan"></i>
                                <span class="dianzan-num">4</span>
                            </div>
                            <div class="action-reply">回覆</div>
                        </div>
                        <div class="comment-date">
                            2022.11.14
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="side-menu">
        <ul class="side-menu-list">
            <li>
                <div class="side-praise-container flex-r">
                    <div class="side-praise-wrapper" id="sidePraise" data-isLogin="{{ session.get('is_login') }}"
                         data-aid="{{ article.aid }}">
                        <i class="iconfont icon-dianzan" id="sidePraiseIcon"></i>
                    </div>
                </div>
                <div class="side-recommend" id="sideRecommend">
                    推薦
                </div>
            </li>
            <!--            <li>收藏</li>-->
            <!--            <li>評論</li>-->
        </ul>
    </div>
    <script>
        // side praise mounted
        const $praise = document.getElementById('praise');
        const $praiseIcon = document.getElementById('praiseIcon');
        const $forta = document.getElementById('forta');
        let praised = 0;
        const $sidePraise = document.getElementById('sidePraise');
        const $sidePraiseIcon = document.getElementById('sidePraiseIcon');
        const $sideRecommend = document.getElementById('sideRecommend');
        const sideAid = $sidePraise.getAttribute('data-aid');
        axios.get('/praise/status', {
            params: {
                aid: sideAid
            }
        }).then(res => {
            if (res.data.status === 4000) {
                praised = res.data.praised;
                if (praised) {
                    $sidePraise.classList.add('praise-alter');
                    $sidePraiseIcon.classList.add('i-alter');
                } else {
                    $sidePraise.classList.remove('praise-alter');
                    $sidePraiseIcon.classList.remove('i-alter');
                }
                if (!res.data.praisedNum) {
                    $sideRecommend.innerHTML = `推薦`;
                } else {
                    $sideRecommend.innerHTML = `${res.data.praisedNum}`;
                }
            }
        });
        // side praise click
        $sidePraise.onclick = function () {
            if (praised) {
                praised = 0;
                axios.post('/praise/update', {
                    aid: sideAid,
                    praised: praised
                }).then(res => {
                    if (res.data.status === 4000) {
                        $praise.classList.remove('praise-alter');
                        $praiseIcon.classList.remove('i-alter');
                        $sidePraise.classList.remove('praise-alter');
                        $sidePraiseIcon.classList.remove('i-alter');
                        if (!res.data.praisedNum) {
                            $forta.innerHTML = `為 TA 點讚`;
                            $sideRecommend.innerHTML = `推薦`;
                        } else {
                            $forta.innerHTML = `${res.data.praisedNum}人點讚`;
                            $sideRecommend.innerHTML = `${res.data.praisedNum}`;
                        }
                    }
                });
            } else {
                praised = 1;
                axios.post('/praise/update', {
                    aid: sideAid,
                    praised: praised
                }).then(res => {
                    if (res.data.status === 4000) {
                        $praise.classList.add('praise-alter');
                        $praiseIcon.classList.add('i-alter');
                        $sidePraise.classList.add('praise-alter');
                        $sidePraiseIcon.classList.add('i-alter');
                        if (!res.data.praisedNum) {
                            $forta.innerHTML = `為 TA 點讚`;
                            $sideRecommend.innerHTML = `推薦`;
                        } else {
                            $forta.innerHTML = `${res.data.praisedNum}人點讚`;
                            $sideRecommend.innerHTML = `${res.data.praisedNum}`;
                        }
                    }
                });
            }
        };
        // praise mounted
        isLogin = $praise.getAttribute('data-isLogin');
        aid = $praise.getAttribute('data-aid');
        axios.get('/praise/status', {
            params: {
                aid: aid
            }
        }).then(res => {
            if (res.data.status === 4000) {
                praised = res.data.praised;
                if (praised) {
                    $praise.classList.add('praise-alter');
                    $praiseIcon.classList.add('i-alter');
                } else {
                    $praise.classList.remove('praise-alter');
                    $praiseIcon.classList.remove('i-alter');
                }
                if (!res.data.praisedNum) {
                    $forta.innerHTML = `為 TA 點讚`;
                } else {
                    $forta.innerHTML = `${res.data.praisedNum}人點讚`;
                }
            }
        });
        // praise click
        $praise.onclick = function () {
            if (praised) {
                praised = 0;
                axios.post('/praise/update', {
                    aid: aid,
                    praised: praised
                }).then(res => {
                    if (res.data.status === 4000) {
                        $praise.classList.remove('praise-alter');
                        $praiseIcon.classList.remove('i-alter');
                        $sidePraise.classList.remove('praise-alter');
                        $sidePraiseIcon.classList.remove('i-alter');
                        if (!res.data.praisedNum) {
                            $forta.innerHTML = `為 TA 點讚`;
                            $sideRecommend.innerHTML = `推薦`;
                        } else {
                            $forta.innerHTML = `${res.data.praisedNum}人點讚`;
                            $sideRecommend.innerHTML = `${res.data.praisedNum}`;
                        }
                    }
                });
            } else {
                praised = 1;
                axios.post('/praise/update', {
                    aid: aid,
                    praised: praised
                }).then(res => {
                    if (res.data.status === 4000) {
                        $praise.classList.add('praise-alter');
                        $praiseIcon.classList.add('i-alter');
                        $sidePraise.classList.add('praise-alter');
                        $sidePraiseIcon.classList.add('i-alter');
                        if (!res.data.praisedNum) {
                            $forta.innerHTML = `為 TA 點讚`;
                            $sideRecommend.innerHTML = `推薦`;
                        } else {
                            $forta.innerHTML = `${res.data.praisedNum}人點讚`;
                            $sideRecommend.innerHTML = `${res.data.praisedNum}`;
                        }
                    }
                });
            }
        };
    </script>
</section>
{% include 'common/modal.html' %}
</body>
</html>

